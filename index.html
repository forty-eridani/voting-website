<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/public/styles.css" />
    <title>Vote</title>
  </head>
  <body id="body">
    <div class="navbar">
      <div class="nav-left">
        <a class="home" href="/">Home</a>
      </div>

      <div class="nav-right">
        <a href="/auth" class="login-state">Sign In</a>
        <a href="/password" class="login-state">Create Account</a>
        <a class="create" href="/create">Create MOTD</a>
      </div>
    </div>

    <div class="vote-item-container" id="container"></div>

    <script>
      let body = document.querySelector("#container");

      window.addEventListener("load", (ev) => {
        fetch("/submissions", {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((res) => {
            return res.json();
          })
          .then((data) => {
            data.forEach((element) => {
              let voteObject = document.createElement("div");
              voteObject.classList.add("vote-object");

              let voteObjectTextSide = document.createElement("div");
              voteObject.appendChild(voteObjectTextSide);
              voteObjectTextSide.classList.add("vote-text-side");

              let motdContainer = document.createElement("h2");
              voteObjectTextSide.appendChild(motdContainer);
              const motdText = document.createTextNode(element.message);
              motdContainer.appendChild(motdText);

              let voteButtonSide = document.createElement("div");
              voteObject.appendChild(voteButtonSide);
              voteButtonSide.classList.add("vote-button-side");

              let voteButton = document.createElement("button");
              voteButton.id = `vote${element.id}`;
              voteButton.classList.add("vote-button");
              voteButtonSide.appendChild(voteButton);

              let buttonText = document.createTextNode("Vote");
              voteButton.appendChild(buttonText);

              let voteCountContainer = document.createElement("h4");
              voteCountContainer.id = `voteCount${element.id}`;
              voteButtonSide.appendChild(voteCountContainer);

              let voteCountText = document.createTextNode(
                `Vote count: ${element.votes}`
              );
              voteCountContainer.appendChild(voteCountText);

              document.getElementById("container").appendChild(voteObject);

              //   body.innerHTML += `
              // <div class="vote-object">
              //   <div class="vote-text-side">
              //     <h2>${element.message}</h2>
              //   </div>
              //   <div class="vote-button-side">
              //     <button class="vote-button" id="vote${index}">Vote</button>
              //     <h4 id="voteCount${index}">Vote count: ${element.votes}</h4>
              //   </div>
              // </div>`;

              voteButton.addEventListener("click", () => {
                let date = new Date();
                fetch("/vote", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    voteID: element.id,
                  }),
                })
                  .then((res) => {
                    return res.json();
                  })
                  .then((data) => {
                    if (data.code == -1) {
                      alert(data.status);
                      return;
                    }
                    voteCountText.data = "Vote count: " + data.votes;
                  });
              });
            });
          });
      });
    </script>

    <script src="/public/navbar.js"></script>
  </body>
</html>
